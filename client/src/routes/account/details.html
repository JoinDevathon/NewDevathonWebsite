<div>
    <DHeader>
        <AccountInfo :account/>
        <GithubAvatar size="150" id="{{account.github_id}}" rounded="true" marginBottom="10px" marginTop="10px"/>
        <h2 class="page-title">Account Details</h2>

        <HeaderTabs>
            <DButton href="/user/{{account.id}}">Back to Profile</DButton>
        </HeaderTabs>
    </DHeader>
    <DBody>
        <!--<ColoredBox title="Account" index="1" id="account">
            <form class="clearfix" method="POST" action="/account/details/account" ref:accountForm>
                {{#if accountLoading}}
                    <LoaderIcon/>
                    <br/>
                {{elseif accountError === null}}
                    <InfoBox><h2>Account Info Saved!</h2></InfoBox>
                    <br/>
                {{/if}}

                <DInput bind:value="details.username" bound id="username" sub="By default, your GitHub username is used. You can override it here.">Username</DInput>

                <div class="buttons">
                    <DButton index="1" on:click="updateAccount(event)" disabled="{{accountLoading}}">Save</DButton>
                </div>
            </form>
        </ColoredBox>
        <br/>-->
        <ColoredBox title="Shipping Information" index="0" id="shipping">
            <form class="clearfix" method="POST" action="/account/details/shipping" ref:shippingForm>
                {{#if shippingLoading}}
                    <LoaderIcon/>
                    <br/>
                {{elseif shippingError}}
                    <ErrorBox><h2>Shipping Error: {{shippingError}}</h2></ErrorBox>
                    <br/>
                {{elseif shippingError === null}}
                    <InfoBox><h2>Shipping Info Saved!</h2></InfoBox>
                    <br/>
                {{/if}}
                <DInput bind:value="shipping.fullname" bound id="name">Full Name</DInput>
                <DInput bind:value="shipping.address1" bound id="address1" sub="Street address, P.O. box, company name, c/o">Address Line 1</DInput>
                <DInput bind:value="shipping.address2" bound id="address2" sub="Apartment, suite, unit, building, floor, etc">Address Line 2</DInput>
                <DInput bind:value="shipping.city" bound id="city">City</DInput>
                <DInput bind:value="shipping.state" bound id="state" sub="No abbreviations">State/Province/Region</DInput>
                <DInput bind:value="shipping.zip" bound id="zip">ZIP/Postal Code</DInput>
                <CountrySelect bind:value="shipping.country" bound id="country" sub="We cannot guarantee shipping to all countries.">Country</CountrySelect>

                <div class="buttons">
                    <DButton index="0" on:click="updateShipping(event)">Save</DButton>
                </div>
            </form>
        </ColoredBox>
    </DBody>
</div>

<style>
    .page-title {
        margin-top: 0.6em;
    }

    form {
        width: 500px;
        max-width: 100%;
        box-sizing: border-box;
        margin: 0 auto;

        padding: 1em;
    }

    .buttons {
        float: right;
    }
</style>

<script>
    import DHeader from '../../components/header/DevathonHeader.html';
    import DBody from '../../components/containers/DevathonBody.html';
    import GithubAvatar from '../../components/images/GithubAvatar.html';
    import AccountInfo from '../../components/account/AccountInfo.html';

    import HeaderTabs from '../../components/header/HeaderTabs.html';
    import DButton from '../../components/forms/DevathonButton.html';

    import ColoredBox from '../../components/containers/ColoredBox.html';
    import DInput from '../../components/forms/DevathonInput.html';
    import CountrySelect from '../../components/forms/CountrySelect.html';

    import LoaderIcon from '../../components/images/LoaderIcon.html';
    import ErrorBox from '../../components/containers/Error.html';
    import InfoBox from '../../components/containers/Info.html';

    import { request, NetworkError } from '../../components/helpers/network';
    import { devathon } from '../common';

    export default {
        data() {
            return devathon({
                shippingLoading: false
            });
        },
        methods: {
            updateAccount(event) {
                event.preventDefault();
            },
            updateShipping(event) {
                event.preventDefault();

                this.set({shippingLoading: true});

                this.refs.shippingForm.scrollIntoView({ behavior: 'smooth' });

                request('/account/details/shipping', {
                    method: 'POST',
                    body: JSON.stringify(this.get('shipping'))
                }).then(res => {
                    this.set({shippingLoading: false, shippingError: null});
                }).catch(err => {
                    if (NetworkError.is(err)) {
                        this.set({shippingLoading: false, shippingError: err.message});
                    } else {
                        this.set({shippingLoading: false, shippingError: 'An unknown server error occurred.'});
                        console.error(err);
                    }
                });
            }
        },
        components: {
            DHeader,
            DBody,

            AccountInfo,
            GithubAvatar,

            HeaderTabs,
            DButton,

            ColoredBox,
            DInput,
            CountrySelect,

            LoaderIcon,
            ErrorBox,
            InfoBox
        }
    };
</script>
